<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
<link rel="stylesheet" href="/resources/css/bootstrap.css">
<link rel="stylesheet" type="text/css" media="screen, projection"
	href="/resources/css/menu.css">
<link rel="stylesheet" type="text/css" media="screen, projection"
	href="/resources/css/style.css">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Nanum+Pen+Script&display=swap" rel="stylesheet">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="/resources/js/mustache.js"></script>
<style type="text/css">
div.wrap1 .wrap2 {
	/* only with left panel- background-image: url(img/bg1.gif); */
	/* right and left panel */
	background-image: url(/resources/img/bg2.gif);
	/* only with right panel - background-image: url(img/bg3.gif); */
}

.jumbotron {
	background-size: cover; =
	color: white;
}

*, *::before, *::after {
    box-sizing: initial; 
}
.fz_board {
    border-collapse: collapse;
    width: 90%;
    table-layout: fixed;
    background-color: #FFF;
    border-top: 2px solid #ddd;
    /*
    border-left: 1px solid #e6e6e6; 
    border-right: 1px solid #e6e6e6;
    */
    display: table;
    font-size:11px;
    font-family:"맑은 고딕","Malgun Gothic";
    margin:0 auto;
    margin-top:3%;
}

.fz_board thead {
    background: linear-gradient(to bottom, #fefefe 0%,#f0f0f0 100%);
    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#fefefe', endColorstr='#f0f0f0',GradientType=0 );
    border-left: 1px solid #DDD;
    border-right: 1px solid #DDD;
    text-align: center;
}

.fz_board tbody td {
    border-bottom: 1px solid #e6e6e6;
    text-align: center;
    height: 35px;
    margin: 10px;
    color: #333;
}

.table-hover tbody tr:hover td {
    background: #fff2e6;
}

.page-link {
	font-size:11px;
    font-family:"맑은 고딕","Malgun Gothic";
}

.active > .page-link {
}

input {
margin-top:0px;
}

.btn_search {
    background: url(/resources/img/sprites_btn.png) no-repeat;
    width: 36px;
    height: 27px;
    line-height: 27px;
    text-indent: -9999px;
    border: 0;
    cursor: pointer;
    padding: 0;
}

select, option {

}

.pagination > li > a
{
	background-color: white;
	color: #c57033;
}

.pagination > li > a:focus,
.pagination > li > a:hover,
.pagination > li > span:focus,
.pagination > li > span:hover
{
	color: #c57033;
	background-color: #eee;
	border-color: #ddd;
}

.pagination > .active > a
{
	color: white;
	background-color: #c57033;
	border: solid 1px #c57033;
}

.pagination > .active > a:hover
{
	background-color: #c57033;
	border: solid 1px #c57033;
}

.welcome-message {
	text-align: center;
	margin-top: 20px;
}

.username {
	font-size: 11px;
	color: #333;
}

.greeting {
	font-size: 18px;
	margin-top: 10px;
	color: #666;
}

.logout-link {
	text-decoration: none;
	color: #c57033;
	font-size: 14px;
	margin-top: 20px;
}

.logout-link:hover {
	color: #964d0d;
}

.welcome-message {
	text-align: center;
	margin-top: 20px;
	padding: 10px;
	border-radius: 5px;
	width: 170px;
	margin-left: 10px;
}

.tooltip-text {
	display: none;
	position: absolute;
	max-width: 200px;
	border-radius: 15px;
	padding: 5px;
	font-size: 0.8em;
	color: black;
	background: #e9ecef;
}

.tooltip-icon:hover .tooltip-text {
	display: initial;
}

.input-border {
	border: 0;
	border-bottom: 1px solid #a6634754;
	background: none;
	outline: 0;
	margin-left: 20px;
	margin-top: 25px;
	transition: border-bottom-color 0.3s ease; /* 부드러운 전환 효과를 위한 transition 설정 */
}

.input-border:focus {
	border-color: black; /* 클릭 시 변경될 색상을 여기에 지정하세요 */
}

.lButton {
	position: relative;
	width: 50px;
	height: 50px;
	background-color: #c57033;
	color: white;
	border: none;
	text-align: center;
	text-decoration: none;
	font-size: 16px;
	cursor: pointer;
	border-radius: 5px;
	display: flex;
	justify-content: center;
	align-items: center;
	float: right;
	margin-right: 29px;
	margin-top: 5px;
}

.lButton::before {
	content: "로그인";
	font-size: 10px;
	font-weight: bold;
	text-shadow: 0px 0px 4px white, 0px 0px 6px white; /* 흰색 부분에 그림자 추가 */
}

.lButton:hover {
	background-color: #964d0d;
}

.lButton:active {
	background-color: #7b3e0a;
}

</style>
<script src="/resources/js/jquery-3.1.1.js"></script>
</head>
<body>
	<div class="wrap1">
		<div class="wrap2">
			<div class="logo" style="cursor: pointer;">
				<div style="display: inline; float: left;">
					여울서버
					<div class="slogan">여러분을 초대합니다.</div>
				</div>
				<div style="display: inline; float: right"></div>
			</div>

			<div id="menu">
				<div class="menu" style="margin-top: -16px;">
					<ul>
						<li></li>
						<li><img src="/resources/img/divider2.png" alt=""></li>
						<li></li>
						<li><img src="/resources/img/divider2.png" alt=""></li>
						<li><span class="hlavny_"><a
								th:href="${community}">커뮤니티(단톡방)</a></span></li>
						<li><img src="/resources/img/divider2.png" alt=""></li>
						<li></li>
						<li><img src="/resources/img/divider2.png" alt=""></li>
						<li><span class="hlavny_"><a
								th:href="${download}">자료실(다운로드)
							</a></span></li>
						<li><img src="/resources/img/divider2.png" alt=""></li>
						<li></li>
						<li><img src="/resources/img/divider2.png" alt=""></li>
						<li><span class="hlavny_"><a href="/board/list">공략게시판
							</a></span></li>
						<li><img src="/resources/img/divider2.png" alt=""></li>
						<li class="active"></li>
					</ul>
				</div>

				<div style="width: 23%; float: left; margin-right:0.5%">
					<form name="fo" method="get" sec:authorize="!isAuthenticated()">
						<input class="input-border" id="id" placeholder="아이디" type="text" size="15" value=""/><br>
						<input class="input-border" id="password" placeholder="비밀번호" type="password" size="15" value="" style="margin-top:10px;"/>
						<button id="login" class="lButton" type="button"></button>
					</form>
					<div class="links" style="margin-top: 20px; margin-left: 22px;" sec:authorize="!isAuthenticated()">
						<a style="text-decoration: none" href="/member/signup">회원가입</a><br>
						<a style="text-decoration: none" href="#"><del>ID/PW 찾기</del></a>
					</div>

					<div sec:authorize="isAuthenticated()" class="welcome-message">
						<div sec:authentication="name" class="username" style="font-family: 'Nanum Pen Script', cursive; font-size: 30px; display:inline; cursor:default "></div>
							<span sec:authorize="hasRole('VIP')" class="tooltip-icon">
							<img style="width:15px; height:15px; cursor: pointer;" src="/resources/img/authorized.png">
							<span class="tooltip-text">인증완료</span>
						</span>
						<span sec:authorize="hasRole('USER')" class="tooltip-icon">
							<img style="width:12px; height:12px; cursor: pointer;" src="/resources/img/unauthorized.png">
							<span class="tooltip-text">미인증</span>
						</span>
						<img onclick="logout();" style="width:15px; height:15px; cursor: pointer; margin-left:10px;" src="/resources/img/logout.png">
					</div>
					<br><br><br><br><br>
					<!--
					<div>여울서버는 어떤곳인가요?</div>
					<div>
						<br>안녕하세요.여울GM입니다.<br> 경험치 보정배율 서버입니다.<br> 서버는 24시간
						상시 ON입니다.<br> 오래 운영할테니 많이 찾아주세요.<br> <br>감사합니다.<br>
						<br> <br>서버오픈일 2020.12.24
					</div>
					<h2>
						경험치 배율: <br>1배 -> 보정배율 변경<br> <br> <br> 서버
						구현률: 100%<br> 서버 안정성: 100%<br> <br> <br>Made
						by 아기사자
					</h2>
					-->
				</div>
				<div class="container" style="width: 75%; float:left; margin-right:0%; padding: 0px 0px 0px 0px; background-color:white; min-height: 674px;">
					<table class="table table-hover fz_board">
						<colgroup>
					        <col width="10%">
					        <col width="50%">
					        <col width="20%">
					        <col width="10%">
					        <col width="10%">
					    </colgroup>
						<thead>
							<tr>
								<th>번호</th>
								<th>제목</th>
								<th>작성자</th>
								<th>날짜</th>
								<th>조회수</th>
							</tr>
						</thead>
						<tbody id="list">
						</tbody>
						<!--
						<tbody id="list" th:if="${list != null}">
							<tr th:each="item : ${list}">
								<td th:text="${item.seq}">{{seq}}</td>
								<td><a th:href="@{/board/view/{seq}(seq=${item.seq})}" th:text="${item.title}">{{title}}</a></td>
								<td th:text="${item.id}"></td>
								<td th:text="${item.registDate}"></td>
								<td th:text="${item.deleteYn}"></td>
							</tr>
						</tbody>
						-->
					</table>
					<br>
					<div>
						<ul class="pagination justify-content-center" id="paging">
						  </ul>
					</div>
					
					<div style="margin-bottom:10px;">
						<select id="select" style="margin-left:25%; height:24.5px; width:70px;">
						  <option value="1" selected>제목</option>
						  <option value="2">작성자</option>
						  <option value="3">내용</option>ㅁㅈㄷㄹ
						  <option value="4">제목+내용</option>
						</select>
						<input id="input" type="text" size="15" maxlength="20" style="justify-content: center !important;">
						<input type="submit" value="검색" class="btn_search" alt="검색" onclick="selectBoardList(1)">	
					</div>
				</div>
			</div>
		</div>

		<div style="text-align: center;">
				&lt;구버전 프리 바람의나라-Renewal By Yeoulserver>
		</div>
	</div>
	<script>
		$(document).ready(function(){
			selectBoardList(1);
		})

		function logout(){
			if(confirm("로그아웃 하시겠습니까?")) {
				alert("로그아웃");
				location.href = "/logout";
			}
		}

		function selectBoardList(page) {
			var data = {
					pageNum : page? page : 1,
			}
			if(!$("#input").val()) {
				
			}else {
				switch ($("#select").val()) {
					case "1" : data.title = $("#input").val();
					break;
					case "2" : data.id = $("#input").val();
					break;
					case "3" : data.content = $("#input").val();
					break;
					case "4" : data.title = $("#input").val(), data.content = $("#input").val();
					break;
				}	
			}
			$.ajax({
				type : "POST",
				data : JSON.stringify(data),
				contentType: 'application/json',
				url : "/board/list",
				headers : {"Access-Control-Allow-Origin" : "*"},
				success : function(response) {
					// 로그출력
					console.log(response);

					// 결과를 뿌리기전에 리스트와 블럭 초기화
					$("#list").empty();
					$("#paging").empty();
					var listHtml;
					if(response.list.length > 0) {

						// 게시글 출력 -> 타임리프로 표기 x
						for(var i=0; i<response.list.length; i++) {
							listHtml = '<tr>'
							listHtml = listHtml + '<td>' + '<p style="margin-top:10px; margin-bottom:0;">' + response.list[i].rowNum + '</p>' + '</td>'
							listHtml = listHtml + '<td>' + '<a style="text-decoration-line:none" href="/board/view/'+response.list[i].seq+'">' + '<p style="margin-top:10px; margin-bottom:0;">' + response.list[i].title + (response.list[i].commentCount ? ' [' + response.list[i].commentCount + ']' : '') + '</p>' + '</td>'
							listHtml = listHtml + '<td>' + '<p style="margin-top:10px; margin-bottom:0;">' + response.list[i].id + '</p>' + '</td>'
							listHtml = listHtml + '<td>' + '<p style="margin-top:10px; margin-bottom:0;">' + response.list[i].registDate + '</p>' + '</td>'
							listHtml = listHtml + '<td>' + '<p style="margin-top:10px; margin-bottom:0;">' + response.list[i].viewCount + '</p>' + '</td>'
							listHtml = listHtml + '</tr>';
							$("#list").append(listHtml);
						}
						// 페이징 출력
						for(var j=response.startPage; j<=response.endPage; j++) {
							if(j == response.pageNum) {
								$("#paging").append('<li class="page-item active"><a class="page-link" href="javascript:void(0)" onclick="selectBoardList('+ j +')">'+ j +'</a></li>');
							}else {
								$("#paging").append('<li class="page-item"><a class="page-link" href="javascript:void(0)" onclick="selectBoardList(' + j + ')">' + j + '</a></li>');
							}
							// 마지막반복시 페이징처리추가
							if(j == response.endPage) {
								if(response.pageNum > 10) {
									$('<li class="page-item"><a class="page-link" href="javascript:void(0)" onclick="selectBoardList('+ (response.startPage-1) +')">이전</a></li>').prependTo("#paging");
									$('<li class="page-item"><a class="page-link" href="javascript:void(0)" onclick="selectBoardList(1)">&lt;&lt;</a></li>').prependTo("#paging");
									if(response.totalPage > response.endPage) {
										$('<li class="page-item"><a class="page-link" href="javascript:void(0)" onclick="selectBoardList(' + (response.startPage + 10) + ')">다음</a></li>').appendTo("#paging");
										$('<li class="page-item"><a class="page-link" href="javascript:void(0)" onclick="selectBoardList(' + response.totalPage + ')">&gt;&gt;</a></li>').appendTo("#paging");
									}
								}
							}
						}
						if(response.principal.authorities[0].authority === 'ROLE_VIP' || response.principal.authorities[0].authority === 'ROLE_ADMIN') {
							$("#paging").append('<li class="page-item" style="margin-left:1%;"><a class="page-link" href="/board/write">글쓰기</a></li>');
						}
					}else {
						listHtml = '<tr>'
						listHtml = listHtml + '<td colspan="5" style="padding: 55px 0 55px 0;">게시물이 없습니다.</td>'
						listHtml = listHtml + '</tr>';
						$("#list").append(listHtml);
						if(response.principal.authorities[0].authority === 'ROLE_VIP' || response.principal.authorities[0].authority === 'ROLE_ADMIN') {
							$("#paging").append('<li class="page-item" style="margin-left:80%;"><a class="page-link" href="/board/write">글쓰기</a></li>');
						}
					}
					/*
					if(response.totalBlock < 11) { // 전체 블록이 10개 이하
						
					}else{
						if(response.pageNum > (response.totalBlock - 10) ){ // 현재 페이지가 마지막 블록대역에 속했을때
							$("#paging").prepend('<li class="page-item"><a class="page-link" href="#" onclick="selectBoardList(1)>&lt;&lt;</a></li>');
							$("#paging").prepend('<li class="page-item"><a class="page-link" href="#" onclick="selectBoardList('+(response.pageNum-1)+')>Previous</a></li>');
						}else if(response.pageNum < 11){	// 현재 페이지가 11페이지 미만일때
							$('<li class="page-item"><a class="page-link" href="#" onclick="selectBoardList('+(response.pageNum+1)+')">Next</a></li>').appendTo("#paging");
							$('<li class="page-item"><a class="page-link" href="#" onclick="selectBoardList('+response.totalCnt+')">&gt;&gt;</a></li>').appendTo("#paging");
						}else { // 나머지 케이스
							$("#paging").prepend('<li class="page-item"><a class="page-link" href="#" onclick="selectBoardList(1)>&lt;&lt;</a></li>');
							$("#paging").prepend('<li class="page-item"><a class="page-link" href="#" onclick="selectBoardList('+(response.pageNum-1)+')>Previous</a></li>');
							$("#paging").appendTo('<li class="page-item"><a class="page-link" href="#" onclick="selectBoardList('+(response.pageNum+1)+')>Next</a></li>');
							$("#paging").appendTo('<li class="page-item"><a class="page-link" href="#" onclick="selectBoardList('+response.totalCnt+')">&gt;&gt;</a></li>');
						}
					}
					*/
				},
				error: function() {
					alert("조회실패!");
				}
			});
		}

		$("#login").on("click",function() {

			if(document.querySelector("#id").value.trim() === '' || document.querySelector("#password").value.trim() === '') {
				alert("아이디 또는 비밀번호를 입력해주세요.");
				return false;
			}
			$.ajax({
				data : {
					username: document.querySelector("#id").value,
					password: document.querySelector("#password").value
				},
				type : "POST",
				url : "/member/login",
				success : function(response) {
					console.log(response);
					if(response.result === 'success') {
						document.location.reload();
					} else {
						alert("아이디 또는 비밀번호가 잘못되었습니다.")
					}
				}
				,error:function(xhr){
					alert("아이디 또는 비밀번호가 잘못되었습니다.")
				}
			});
		});

		$(".logo").on("click",function(){
			location.href="/";			
		});
	</script>
</body>
</html>